MVI B,01H ;OUR DELAY = 1MS*500 = 0.5 SEC 
MVI C,F4H 
 
BEGIN:

LDA 2000H ;READ INPUT 
RAR ;CHECK LSB 
JC BEGIN ;IF LSB NOT 0 READ AGAIN THE INPUT 
 
SWITCH_OFF_ON:
 
LDA 2000H ;READ INPUT
RAR ;SWITCH UP -> LSB=1 
JNC SWITCH_OFF_ON ;IF LSB == 0 CONTINUE READING UNTIL IT BECOMES 1 ELSE CONTINUE 
 
SWITCH_OFF_ON_OFF:  
 
LDA 2000H ;READ INPUT
RAR ; CHECKING LSB (WE WANT IT TO BE 0) 
JC SWITCH_OFF_ON_OFF ;CONTINUE READING UNTIL IT BECOMES 0 AGAIN
 
  
LEDS_ON:  
;WE ARE HERE IF SWITCH GOES DOWN->UP->DOWN SO LEDS ARE ON
MVI D,00H ;OFF-ON-OFF FLAG 
MVI E,0FH ;E = 15 DECIMAL FOR THE DELAY (15(2*0.5) = 15 SEC)

 
DELAY:
MVI A,00H ; SWITCHING ON AND OFF ALL LEDS 
STA 3000H
CALL DELB ;0.5 SECOND DELAY
MVI A,FFH
STA 3000H
CALL DELB ;0.5 SECOND DELAY

DCR E ;DECRIMENT BY 1 , STARTING FROM 30
MOV A,E ;CHECK IF 15 SECONDS HAVE PASSED
CPI 00H  
JZ TURN_OFF_LEDS ;YES? CLOSE LEDS 
MOV A,D ;NO? CHECK D TO SEE OUR CURRENT SITUATION   
CPI 00H  
JZ LEDS_ARE_ON ;IF D=0 OUR LEDS ARE ON. ELSE CHECK WHERE IT IS NOW
CPI 01H ; 
JZ OFF_ON ;IF D=1 OUR SWITCH IS ON AFTER BEING OFF.CHECK WHERE IT IS NOW  
CPI 02H ;  
JZ OFF_ON_OFF ;IF D=2 OUR SWITCH IS OFF-ON-OFF. CHECK WHERE IT IS NOW 
 
TURN_OFF_LEDS: 
 
MVI A,FFH 
STA 3000H ;CLOSING ALL LEDS 
JMP BEGIN ;RESTART OPERATION

LEDS_ARE_ON: 
 
LDA 2000H ; READ INPUT 
RAR 
JC DELAY ;IF SWITCH IS ON THEN GO TO DELAY STATE ELSE WE ARE IN OFF STATE 
INR D ;STORE OFF STATE =1 
 
 
OFF_ON:  ;NOW D = 1 
LDA 2000H 
RAR
JNC DELAY ;IF SWITCH IS OFF THEN GO TO DELAY ELSE WE ARE IN OFF-ON STATE  
INR D ;STORE OFF - ON STATE = 2 
 
 
OFF_ON_OFF: 
; NOW D = 2 
LDA 2000H 
RAR 
JC DELAY ; IF SWITCH STILL ON GO TO DELAY ELSE WE ARE IN OFF - ON - OFF STATE 
 
REMAINS_ON: 
JMP LEDS_ON ;RELOAD TIME LIMIT
END 